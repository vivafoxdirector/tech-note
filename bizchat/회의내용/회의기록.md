# 20201019
1. WEB/ADMIN 로그인 권한들이 있다.
2. 상태: 승인요청/반려 => 수정이 된다.
3. 페이지
   240~2(리포트),
   '마이페이지': RCS client 를 등록해야 하는가?
4. 관리자아이디, 서브아이디가 있다. 고객사별 관리자 아이디는 1개이고, 서브아이디는 여러개이다. 
5. 통계
6. RCS작성 -> 관리자화면(231페이지-설문승인)->발송/반려/승인,  설문조회: 발송이 완료된것을 말함.   

# 20201020
## 미팅 준비
### 도메인 지식
1. (★:7)비즈챗중에 상담 비즈챗, 설문 비즈챗 용도 및 차이?

### 문의사항
1. RCS도 통신사별 처리가 있는가?(내부 코드는 통신사별 QUEUE가 존재)
2. 코드그룹(COM_CD_GRP)테이블은 언제 Insert 되는가? 관련 sql이 있는가?
3. MMS전송시 첨부파일(JPG, JPEG)를 스토리지에 저장한다. RCS와 차이점은?
4. AGENT의 역할이 구체적으로 무엇인가? RCS도 AGENT를 사용하는 경우가 있는가?
5. DB에서 MessageQueue 정보 조회시 사용하는 RLC(중계사), DLC(딜러) 테이블은 무엇인가? 이와같은 테이블이 더 있는지? 있다면 각각의 명세는?
6. MMS 최종 Client에서 전송시 SOAP처리를 한다. RCS도 마찬가지로 SOAP포맷이 있는가?
7. RCS 최종 전송에 대한 응답 전문 포맷은 Soap(XML)형태인가? 
   - 응답상태 코드별 행동은?
   - 미지원 단말 여부
8. ★:8 MMS전송 결과를 VMG가 HTTP를 이용해서 전송하고 이에대한 결과 응답 전문이 있는듯 하다... RCS도 응답 전문이 있는가?(SktDeliveryReportController)

## 고객사 미팅
### 비지니스 및 로직 설명
- 설문은 skt만한다.
- RCS는 cid필요없을듯.토큰을 이용한다.
- 모듈 agent/agent-test는 테스트용도
- async는 엑셀같은 다운로드 하기위한 모듈
- batch는 더이상 사용하지 않는 정보등을 지운다.
- cache(mdn, 고객정보), common, mq 는 공통 모듈
- mobile 관련 프로젝트는 관리자 화면에는 있으나 아직은 사용하지 않는다.(고객이 없다..)
- survey-agent 설문서버이다.(RCS 개발시 관련있다.)
- agent, survey-agent가 사용하는 테이블은 SND_MSG, RCV_MSG이다. survey-agent가 3초마다 SND_MSG를 조회해서 API를 호출해서 MT_SND_REQ에 전송플로우를 타도록 한다.
  - 관련테이블: SND_MSG, MT_SND_SEQ, MT_MSG_QUEUE, MT_SND_HIST, RCV_MSG
  - 주요소스: ReceiveMsgHandler.java 와 scheduler 패키지
  - SurveyService 는 메시지는 또 발송 할 것인지에 대한 로직이 있다.

### 고객사 요청사항
1. 변경될 코드 및 항목들이 어떤것이 있는지 (공통코드, 디비테이블, 나스디렉토리)어떻게 바뀔것인지 안이 나와야 한다.(일정을 알림은 금주중으로...)
2. 1번사항이 어느정도 구체화가 되면 고객사에서는 RCS 클라이언트 스켈레톤 개발이 가능하다.


# 20201105
## SK미팅 준비
1. 스키마
- 영향도가 있는 스키마 변경 (NULL허용 및 컬럼 추가)
	- SURVEY, SURVEY_HISTORY
2. 설문[등록]단계
	- 일반과 RCS도 같은 시작일시, 종료일시를 가질수 있는지... 설문시작시간 체크와 관련이 있어 보인다.
	- 설문등록시 설문 스케쥴을 등록하여 설문시작시간 체크를 하게 된다. 이부분에 대한 상세 내용을 들었으면 한다.
	- 소스레벨에서 BookingSchedule 은 어디에서 쓰이는 클래스인가
3. 설문상태
	- PRE_CHECK는 어느시점에 다시 APPR이 되는지 구체적인 설명
2. 설문[승인]단계
	- 메일 보내기 (★ 메일 타이틀 작성시 RCS는 별도로 하는가?)
3. SndMsgVO에는 RCS관련 정보를 담을 것인가?
	- SndMsgVO::msgTp 
		=> RCS타입 추가
		=> msgTitle: RCS인경우 고민
		=> msgCont : RCS인경우 고민
4. 테이블 snd_msg(발신 메시지), snd_attfile(발신 첨부 파일) 3번과 마찬가지로 RCS관련하여 수정할 사항이 있는가?
5. 수정 모듈
	- web
	- admin
	- survey-agent

## SK미팅내용
1. 미팅시작
- 아무리 늦어도 12월 2주차에 QA를 진행한다.
- 이번달말까지 테스트가 완료되어야 한다.
	- 성능시험도 본다.

* 비즈챗은 2가지 방법
- 지정해서 보내는거
- 타게팅은 본인이 하는것 -> SK담당자가 조건에 맞는 사람을 뽑는다. -> 이후 나온 자료를 로딩
	- 타게팅은 95% 정도 사용률을 가진다

PRE_CHECK + 광고수신 동의
오후 10시에 광고수신동의 체크를 한다.
타게팅 테이블에 YN 가 있다.

18시 ~ 10시까지 동의 대사를 하지 않는다.
10시 ~ 6시까지 오전에 나갈것을 전송

레지스트 상태로 바뀌면서 동의대사 (동의 대사 시간당 12만건보낸다. )

SND_MSG 에 RCS냐 일반
- MSG_TP: LMS_RCS, MMS_RCS

* 테스트계
설문번호별 디렉토리가 있다.
survey01 / survey 디렉토리 / nfs_data / 


* 스키마
SURVEY_RCS는 풀어서 설계하도록 하자 RCS 타이틀, 내용, 파일을 컬럼을 *6개 저장하도록 한다.

* 메시지(엑셀 파일 참조)
메시지 밸리데이션 (엑셀 파일이 있다. 전달 해줬다고 한다.)
이건 머지?????!!
가로형은 안쓴다. 세로형만 쓴다.(엑셀에 2, 4, 10, (14번은 알아봐야함)을 사용한다고 한다.)
미디엄/옵션을 보낼건지에 대해서 알려달라....
20200630_포멧_리스트_v11.3_메시지_밸리데이션_포함 - 복사본
- 푸터 관련해서는 헤더가 있으면 푸터가 있고 푸터(무료 수신 거부) 내용은 survey에 있는듯하다.
- TODO: 전체 미디어 사이즈가 1메가가 넘으면 안된다. 

* 메시지 클라이언트
/token
/message 송신
	- 메시지 타입
	- 이미지는 mappurl, sourcefile, 


# 20201204
## 미팅준비
1. [코드삽입] 같은 경우는 어느시점에 작업이 진행되어야 하는지 논의필요. 기존에는 3초 스케쥴러에서 RUNNING설문을 조회하여 타겟넘버와 쿠폰번호 매핑해서 치환작업을 진행하였다.
RCS같은 경우는 별도의 테이블에 내용이 존재 하기때문에 어느시점에서 진행을 해야 하는지.... 고민한 방법은 아래와 같다.
        - MsgQueueVO에 서브 VO에다가 넣는방법
        - 그외...
2. 전체 플로우가 끝나고 나서 SURVEY 삭제 처리 하는 부분은 어느부분인지....
3. 리모트 디버그 사용가능여부...
        - 결국 안된다. 들어오는 아이피를 열어주어야 한다고 한다. 절차가 복잡하다고함.

## 미팅내용
1. 15일 이전에 테스트가 완료가 되어야 한다.
2. 차주 화요일 테스트 유매니저님과 같이..
3. MT_MSG_QUEUE 에 MSG_ID, RCS_SEQ 가 있어야 한다.
        - msg_id 이면 메시지의 유니크한 값을 말한다.
        - SND_MSG 에서 message시퀀스가 곧 msg_id가 되도록 해서 mt_msg_queue에 넣으면 될듯하다
        - bizchat에서 발송기에 msgId보내도록 되어 있다. (유매니저님은 임의로 bizchat_[epochtime]으로 해서 테스트하고 있다고 한다.)
        => 잘못 알앗다 msg_id가 아니고, customer_req_id이다. 이는 MT_MSG_QUEUE에 해당 컬럼이 있다. 현재 custom_req_id에는 값이 들어가도록 되어 있다. 위의 msg_id 설명이  snd_msg:msg_seq 가 customer_req_id 가 맞느냐?
4. 오류코드
        403, 329: 리트라이한다. (오류코드는 엑셀 파일 참조)
        500: 리트라이
        54001: 이면 그냥 끝내고 된다.
        54002: 이면 MMS/LMS 보내야 하는 코드이다.
        54004: 리트라이를 해야하는지... 54001과 같게 처리되도록 한다.
5. 설문 등록시 이미지는 NAS에 전송하도록한다.
        => NAS저장
        => maaper fileid 확인 요청시 응답에 expired date가 있다. 이를 start_survey_dttm 과 비교해서 해야하는 처리가 있어야 할듯...
        => 테스트 전송은 maaperurl이 하고
        => 이후 테스트 스케쥴러가 하루전에 maaper를 읽어서 mapperurl을 가져와서 넣는 방법을 생각해 볼 수 있다.
6. 일반설문 + RCS설문이면 SND_MSG는 한개가 되어야 한다.
        - RCS를 먼저 보내고... 54002 오류가 났을때 일반설문이 SND_MSG 업데이트 되도록 되어야한다. 고민해야한다... 어떻게 처리가 되어야 할지....
7. SURVEY 테이블 '동의 안내 메시지'는 not null 에서 null 로 바뀌어야 할듯하다. RCS only인경우가 있기때문..
8. survey-agent 설명
        - ReceiveMsgHandler => MT 
                => modifyMtRcvInfo(성공실패결정)
                        -> snd_msg(fail_cd, fail_cont)
                        -> rcvVO에 헤더, 바디 ResultNotificationVO::transactionId === CUSTOMER_ID이고, SND_MSG의 MSG_ID?일 것이다.)
                => 성공했을때의 처리가 있다. 지금까지 성공에 대해서만 있다. 
                => 이제는 실패을경우의 처리가 있어야 한다.
                        => RCS 오류코드를 봐서 LMS/MMS 용도로 같은 SEQ에 SND_MSG를 업데이트 해야 한다.
                                => MT_MSG_REQUET 로 보내면 될듯하다......
                                => 관련테이블
                                        MT_MGR: MT_SND_HIST, MT_SND_ACTION_HIST
                                        SURVEY-AGENT: SND_MSG, MT_MSG_QUEUE
                        => 3초 스케쥴로 보내도록 한다. (코드치환 때문이다) 
                                => MT_MSG_QUEUE 에 INSERT UPDATE 하도록 한다.
                                
9. 설문2서버에서 배치가 동작되고 있다고 한다.
        => 설문 몇시간 전에 maaperUrl하도록 하면 어떠한지 생각..
10. 테스트기계는 신규번호로 해야한단다.
11. MMS는 빼고.. 차주 월요일즈음에 LMS발송 테스트할 수 있도록 6시이후에...
12. rabbitmq에서 MT_MGR_REQUEST 는 항상 0건이어야 한다.!!!!!!!!! 

13. 설문등록시 이미지는 NAS에 저장
14. SND_MSG에 MSG_CONT를 넣어야 한다.